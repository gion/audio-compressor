"use strict";window.AudioCompresser=function(){function a(a){var b=a.split(":");return 60*parseFloat(b[0])*60+60*parseFloat(b[1])+parseFloat(b[2])+parseFloat("0."+b[3])}var b=function(a,b){this.worker=null,this.workerRunning=!1,this.fileName=null,this.fileBuffer=null,this.bitRate="96k",this.format="mp3",this.events={},this._init(a,b)};return b.prototype={_init:function(a,b){return this.fileName=a,this.fileBuffer=b,this.initWorker(),this},_getArguments:function(){var a=[],b=this.fileName.replace(/\..*?$/,"");switch(a.push("-i"),a.push(this.fileName),a.push("-b:a"),a.push(this.bitRate),this.format){case"mp3":a.push("-acodec"),a.push("libmp3lame"),a.push(b+".mp3");break;case"ogg":a.push("-acodec"),a.push("libvorbis"),a.push(b+".ogg");break;case"aac":a.push("-acodec"),a.push("libfdk_aac"),a.push(b+".mp4");break;case"wma":a.push("-acodec"),a.push("wmav1"),a.push(b+".asf")}return a},_getMimeType:function(){return"audio/"+this.format},convert:function(){this.worker.postMessage({type:"command",arguments:this._getArguments(),files:[{name:this.fileName,buffer:this.fileBuffer}]})},on:function(a,b){return this.events[a]||(this.events[a]=[]),this.events[a].push(b),this},off:function(a,b){if(1===arguments.length)this.events[a]=[];else{var c=this.events[a].indexOf(b);-1!==c&&this.events[a].splice(c,1)}return this},initWorker:function(){return this.worker&&this.workerRunning&&this.worker.terminate(),this.worker=this._getFFMPEGWorker(),this.workerRunning=!0,this},trigger:function(a,b){return this.events[a]&&this.events[a].forEach(function(c){c({type:a,data:b},b)}),this},_getFFMPEGWorker:function(){var b,c=this,d=/Duration: (.*?), /,e=/time=(.*?) /,f=new Worker("scripts/worker.js");return f.addEventListener("message",function(f){var g,h,i=f.data;if(c.trigger(i.type,i),"stderr"===i.type)!b&&d.exec(i.data)&&(b=a(d.exec(i.data)[1])),b&&e.exec(i.data)&&(g=a(e.exec(i.data)[1]),h=Math.floor(g/b*100),c.trigger("progress",h));else if("done"===i.type){var j=i.data.code,k=Object.keys(i.data.outputFiles);if(0===j&&k.length){var l=k[0],m=i.data.outputFiles[l],n=new Blob([m],{type:c._getMimeType()}),o=window.URL.createObjectURL(n),p={name:l,buffer:m,blob:n,url:o};c.trigger("success",p)}else c.trigger("fail",i.data)}},!1),f}},b}();